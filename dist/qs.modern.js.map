{"version":3,"file":"qs.modern.js","sources":["../src/index.js"],"sourcesContent":["/*\r\n * Initialise events and template\r\n */\r\nconst addTemplate = createTemplate()\r\n\r\nmodule.exports = function (literals, ...substitutions) {\r\n  const query = createQuery(literals, substitutions)\r\n  if (!query || query.length === 0 || query === '[object Object]') return null\r\n  if (Array.isArray(query)) {\r\n    return addTemplate(query)\r\n  } else {\r\n    const elements = Array.from(document.querySelectorAll(query))\r\n    return elements.length > 0 ? addTemplate(elements) : []\r\n  }\r\n}\r\n\r\n/*\r\n * Initialises events and customMethods, then returns a function that applies\r\n * changes to an element list:\r\n\r\n * Each of these properties applies to every element in the array:\r\n * - Adds every type of eventListener to the qs element list's hidden properties\r\n *   qs`.element`.click(clickFunc)\r\n * \r\n * - Adds a .remove property, to remove eventListeners \r\n *   qs`.element`.remove.click(clickFunc)\r\n * \r\n * - Adds set, to set properties of elements\r\n *   qs`.element`.set(el => el.style.color = 'red')\r\n * \r\n * - Adds get, to get an array of properties of elements\r\n *   const getText = qs`.element`.get(el => el.innerHTML) // ['an element', 'inside another']\r\n * \r\n * - Adds only to select a single element from an index, returning an array of 1\r\n *   qs`.element`.only(1) // [ HTMLElement ]\r\n * \r\n * - Modifies the following array methods, to return an array that has been parsed by qs:\r\n *   Filter\r\n *   qs`.element`.filter(el => el.innerHTML.includes('Title'))\r\n */\r\nfunction createTemplate () {\r\n  const events = getAllEvents()\r\n  const customMethods = {\r\n    set: setFunction,\r\n    get: getFunction,\r\n    only: onlyFunction,\r\n    filter: arrayFunction\r\n  }\r\n  return function (elements) {\r\n    const customProps = {}\r\n    const removeEventObject = {}\r\n    events.forEach(event => {\r\n      addAFunction(customProps, event, eventFunction, { elements, event })\r\n      removeEventObject[event] = removeEventFunction({ elements, event })\r\n    })\r\n    customProps.remove = { value: removeEventObject }\r\n    Object.entries(customMethods).forEach(([methodName, methodFunc]) => {\r\n      addAFunction(customProps, methodName, methodFunc, { elements, methodName })\r\n    })\r\n    return Object.defineProperties(elements, customProps)\r\n  }\r\n}\r\n\r\n/*\r\n * Adds a function to customProps, to be used in defuneProperties\r\n */\r\nfunction addAFunction (customProps, propName, propFunc, funcVars) {\r\n  customProps[propName] = {\r\n    value: propFunc(funcVars)\r\n  }\r\n}\r\n\r\n/*\r\n * The next few functions are all non-enumerable properties given to the created qs objects\r\n * Or in one case, an object that enables removes event listeners\r\n * \r\n * Creates an event listener, returns elements\r\n */\r\nfunction eventFunction ({ elements, event }) {\r\n  return function (func) {\r\n    elements.forEach(element => {\r\n      element.addEventListener(event, func)// (jsEvent) => {\r\n      //  func (jsEvent, elements)\r\n      //})\r\n    })\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Removes event listener, returns elements\r\n */\r\nfunction removeEventFunction ({ elements, event }) {\r\n  return function (func) {\r\n    console.log('Removing', event, elements)\r\n    elements.forEach(element => {\r\n      element.removeEventListener(event, func)\r\n    })\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Applies array method then returns qs templated array\r\n */\r\nfunction arrayFunction ({ elements, methodName }) {\r\n  return function (func) {\r\n    return addTemplate([][methodName].call(elements, func))\r\n  }\r\n}\r\n\r\n/*\r\n * Cycles through elements letting you edit elements\r\n */\r\nfunction setFunction ({ elements }) {\r\n  return function (func) {\r\n    elements.forEach(func)\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Returns elements selected in func\r\n */\r\nfunction getFunction ({ elements }) {\r\n  return function (func) {\r\n    return elements.map(element => func(element))\r\n  }\r\n}\r\n\r\n/*\r\n * Selects an element by index and returns a qs templated array containing it\r\n */\r\nfunction onlyFunction ({ elements }) {\r\n  return function (index) {\r\n    return addTemplate([elements[index]])\r\n  }\r\n}\r\n\r\n/* \r\n * Returns an array of names of all available events\r\n * Will always find a list of events, the second return value is for testing\r\n */\r\nfunction getAllEvents () {\r\n  const allEvents = Object.getOwnPropertyNames(Object.getPrototypeOf(Object.getPrototypeOf(document))).filter(eventName =>\r\n    !eventName.indexOf('on') && (document[eventName] == null || typeof document[eventName] == 'function')\r\n  ).map(eventName => eventName.substr(2))\r\n  return allEvents.length > 0 ? allEvents : ['click', 'mouseover']\r\n}\r\n\r\n/*\r\n * Takes arguments from a tagged template literal\r\n * If valid HTML element array submitted as first argument, return\r\n * Else If array entered as a substitution, and no literals, return substitution array\r\n * Else If return a query string to be used with document.querySelectorAll\r\n * If not valid, return null\r\n */\r\nfunction createQuery (literals, substitutions) {\r\n  if (Array.isArray(literals) && literals.every(isValidElement)) {\r\n    return literals\r\n  } else if (Array.isArray(literals) && Array.isArray(substitutions)) {\r\n    if (literals.join() === '' && substitutions.every(isValidElement)) {\r\n      return substitutions\r\n    } else {\r\n      return literals.map((literal, index) => {\r\n        return (literal || '') + (substitutions[index] || '')\r\n      }).join('') || null\r\n    }\r\n  } else if (typeof literals === 'string' || literals instanceof String) {\r\n    return literals\r\n  } else {\r\n    return null\r\n  }\r\n}\r\n\r\n/*\r\n *  Check if element is valid DOM element\r\n */\r\nfunction isValidElement (element) {\r\n  return element instanceof Element || element instanceof HTMLDocument\r\n}"],"names":["addTemplate","events","allEvents","Object","getOwnPropertyNames","getPrototypeOf","document","filter","eventName","indexOf","map","substr","length","getAllEvents","customMethods","set","setFunction","get","getFunction","only","onlyFunction","arrayFunction","elements","customProps","removeEventObject","forEach","event","addAFunction","eventFunction","func","console","log","element","removeEventListener","removeEventFunction","remove","value","entries","methodName","methodFunc","defineProperties","createTemplate","propName","propFunc","funcVars","addEventListener","call","index","isValidElement","Element","HTMLDocument","module","exports","literals","substitutions","query","Array","isArray","every","join","literal","String","createQuery","from","querySelectorAll"],"mappings":"AAGA,MAAMA,EAqCN,WACE,MAAMC,EAsGR,WACE,MAAMC,EAAYC,OAAOC,oBAAoBD,OAAOE,eAAeF,OAAOE,eAAeC,YAAYC,OAAOC,IACzGA,EAAUC,QAAQ,QAAiC,MAAvBH,SAASE,IAAoD,mBAAvBF,SAASE,KAC5EE,IAAIF,GAAaA,EAAUG,OAAO,IACpC,OAAOT,EAAUU,OAAS,EAAIV,EAAY,CAAC,QAAS,aA1GrCW,GACTC,EAAgB,CACpBC,IAAKC,EACLC,IAAKC,EACLC,KAAMC,EACNb,OAAQc,GAEV,gBAAiBC,GACf,MAAMC,EAAc,GACdC,EAAoB,GAS1B,OARAvB,EAAOwB,QAAQC,IACbC,EAAaJ,EAAaG,EAAOE,EAAe,CAAEN,SAAAA,EAAUI,MAAAA,IAC5DF,EAAkBE,GAuCxB,UAA8BJ,SAAEA,EAAFI,MAAYA,IACxC,gBAAiBG,GAKf,OAJAC,QAAQC,IAAI,WAAYL,EAAOJ,GAC/BA,EAASG,QAAQO,IACfA,EAAQC,oBAAoBP,EAAOG,KAE9BP,GA7CsBY,CAAoB,CAAEZ,SAAAA,EAAUI,MAAAA,MAE7DH,EAAYY,OAAS,CAAEC,MAAOZ,GAC9BrB,OAAOkC,QAAQvB,GAAeW,QAAQ,EAAEa,EAAYC,MAClDZ,EAAaJ,EAAae,EAAYC,EAAY,CAAEjB,SAAAA,EAAUgB,WAAAA,MAEzDnC,OAAOqC,iBAAiBlB,EAAUC,IAxDzBkB,GA+DpB,SAASd,EAAcJ,EAAamB,EAAUC,EAAUC,GACtDrB,EAAYmB,GAAY,CACtBN,MAAOO,EAASC,IAUpB,SAAShB,GAAeN,SAAEA,EAAFI,MAAYA,IAClC,gBAAiBG,GAMf,OALAP,EAASG,QAAQO,IACfA,EAAQa,iBAAiBnB,EAAOG,KAI3BP,GAoBX,SAASD,GAAeC,SAAEA,EAAFgB,WAAYA,IAClC,gBAAiBT,GACf,OAAO7B,EAAY,GAAGsC,GAAYQ,KAAKxB,EAAUO,KAOrD,SAASb,GAAaM,SAAEA,IACtB,gBAAiBO,GAEf,OADAP,EAASG,QAAQI,GACVP,GAOX,SAASJ,GAAaI,SAAEA,IACtB,gBAAiBO,GACf,OAAOP,EAASZ,IAAIsB,GAAWH,EAAKG,KAOxC,SAASZ,GAAcE,SAAEA,IACvB,gBAAiByB,GACf,OAAO/C,EAAY,CAACsB,EAASyB,MA2CjC,SAASC,EAAgBhB,GACvB,OAAOA,aAAmBiB,SAAWjB,aAAmBkB,aA9K1DC,OAAOC,QAAU,SAAUC,KAAaC,GACtC,MAAMC,EAuJR,SAAsBF,EAAUC,GAC9B,OAAIE,MAAMC,QAAQJ,IAAaA,EAASK,MAAMV,GACrCK,EACEG,MAAMC,QAAQJ,IAAaG,MAAMC,QAAQH,GAC1B,KAApBD,EAASM,QAAiBL,EAAcI,MAAMV,GACzCM,EAEAD,EAAS3C,IAAI,CAACkD,EAASb,KACpBa,GAAW,KAAON,EAAcP,IAAU,KACjDY,KAAK,KAAO,KAEY,iBAAbN,GAAyBA,aAAoBQ,OACtDR,OAnKKS,CAAYT,EAAUC,GACpC,IAAKC,GAA0B,IAAjBA,EAAM3C,QAA0B,oBAAV2C,EAA6B,YACjE,GAAIC,MAAMC,QAAQF,GAChB,OAAOvD,EAAYuD,GACd,CACL,MAAMjC,EAAWkC,MAAMO,KAAKzD,SAAS0D,iBAAiBT,IACtD,OAAOjC,EAASV,OAAS,EAAIZ,EAAYsB,GAAY"}