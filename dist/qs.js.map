{"version":3,"file":"qs.js","sources":["../src/index.js"],"sourcesContent":["/*\r\n * Initialise events and template\r\n */\r\nconst addTemplate = createTemplate()\r\n\r\nmodule.exports = function (literals, ...substitutions) {\r\n  const query = createQuery(literals, substitutions)\r\n  if (!query || query.length === 0 || query === '[object Object]') return null\r\n  if (Array.isArray(query)) {\r\n    return addTemplate(query)\r\n  } else {\r\n    const elements = Array.from(document.querySelectorAll(query))\r\n    return elements.length > 0 ? addTemplate(elements) : []\r\n  }\r\n}\r\n\r\n/*\r\n * Initialises events and customMethods, then returns a function that applies\r\n * changes to an element list:\r\n\r\n * Each of these properties applies to every element in the array:\r\n * - Adds every type of eventListener to the qs element list's hidden properties\r\n *   qs`.element`.click(clickFunc)\r\n * \r\n * - Adds a .remove property, to remove eventListeners \r\n *   qs`.element`.remove.click(clickFunc)\r\n * \r\n * - Adds set, to set properties of elements\r\n *   qs`.element`.set(el => el.style.color = 'red')\r\n * \r\n * - Adds get, to get an array of properties of elements\r\n *   const getText = qs`.element`.get(el => el.innerHTML) // ['an element', 'inside another']\r\n * \r\n * - Adds only to select a single element from an index, returning an array of 1\r\n *   qs`.element`.only(1) // [ HTMLElement ]\r\n * \r\n * - Modifies the following array methods, to return an array that has been parsed by qs:\r\n *   Filter\r\n *   qs`.element`.filter(el => el.innerHTML.includes('Title'))\r\n */\r\nfunction createTemplate () {\r\n  const events = getAllEvents()\r\n  const customMethods = {\r\n    set: setFunction,\r\n    get: getFunction,\r\n    only: onlyFunction,\r\n    filter: arrayFunction\r\n  }\r\n  return function (elements) {\r\n    const customProps = {}\r\n    const removeEventObject = {}\r\n    events.forEach(event => {\r\n      addAFunction(customProps, event, eventFunction, { elements, event })\r\n      removeEventObject[event] = removeEventFunction({ elements, event })\r\n    })\r\n    customProps.remove = { value: removeEventObject }\r\n    Object.entries(customMethods).forEach(([methodName, methodFunc]) => {\r\n      addAFunction(customProps, methodName, methodFunc, { elements, methodName })\r\n    })\r\n    return Object.defineProperties(elements, customProps)\r\n  }\r\n}\r\n\r\n/*\r\n * Adds a function to customProps, to be used in defuneProperties\r\n */\r\nfunction addAFunction (customProps, propName, propFunc, funcVars) {\r\n  customProps[propName] = {\r\n    value: propFunc(funcVars)\r\n  }\r\n}\r\n\r\n/*\r\n * The next few functions are all non-enumerable properties given to the created qs objects\r\n * Or in one case, an object that enables removes event listeners\r\n * \r\n * Creates an event listener, returns elements\r\n */\r\nfunction eventFunction ({ elements, event }) {\r\n  return function (func) {\r\n    elements.forEach(element => {\r\n      element.addEventListener(event, func)// (jsEvent) => {\r\n      //  func (jsEvent, elements)\r\n      //})\r\n    })\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Removes event listener, returns elements\r\n */\r\nfunction removeEventFunction ({ elements, event }) {\r\n  return function (func) {\r\n    console.log('Removing', event, elements)\r\n    elements.forEach(element => {\r\n      element.removeEventListener(event, func)\r\n    })\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Applies array method then returns qs templated array\r\n */\r\nfunction arrayFunction ({ elements, methodName }) {\r\n  return function (func) {\r\n    return addTemplate([][methodName].call(elements, func))\r\n  }\r\n}\r\n\r\n/*\r\n * Cycles through elements letting you edit elements\r\n */\r\nfunction setFunction ({ elements }) {\r\n  return function (func) {\r\n    elements.forEach(func)\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Returns elements selected in func\r\n */\r\nfunction getFunction ({ elements }) {\r\n  return function (func) {\r\n    return elements.map(element => func(element))\r\n  }\r\n}\r\n\r\n/*\r\n * Selects an element by index and returns a qs templated array containing it\r\n */\r\nfunction onlyFunction ({ elements }) {\r\n  return function (index) {\r\n    return addTemplate([elements[index]])\r\n  }\r\n}\r\n\r\n/* \r\n * Returns an array of names of all available events\r\n * Will always find a list of events, the second return value is for testing\r\n */\r\nfunction getAllEvents () {\r\n  const allEvents = Object.getOwnPropertyNames(Object.getPrototypeOf(Object.getPrototypeOf(document))).filter(eventName =>\r\n    !eventName.indexOf('on') && (document[eventName] == null || typeof document[eventName] == 'function')\r\n  ).map(eventName => eventName.substr(2))\r\n  return allEvents.length > 0 ? allEvents : ['click', 'mouseover']\r\n}\r\n\r\n/*\r\n * Takes arguments from a tagged template literal\r\n * If valid HTML element array submitted as first argument, return\r\n * Else If array entered as a substitution, and no literals, return substitution array\r\n * Else If return a query string to be used with document.querySelectorAll\r\n * If not valid, return null\r\n */\r\nfunction createQuery (literals, substitutions) {\r\n  if (Array.isArray(literals) && literals.every(isValidElement)) {\r\n    return literals\r\n  } else if (Array.isArray(literals) && Array.isArray(substitutions)) {\r\n    if (literals.join() === '' && substitutions.every(isValidElement)) {\r\n      return substitutions\r\n    } else {\r\n      return literals.map((literal, index) => {\r\n        return (literal || '') + (substitutions[index] || '')\r\n      }).join('') || null\r\n    }\r\n  } else if (typeof literals === 'string' || literals instanceof String) {\r\n    return literals\r\n  } else {\r\n    return null\r\n  }\r\n}\r\n\r\n/*\r\n *  Check if element is valid DOM element\r\n */\r\nfunction isValidElement (element) {\r\n  return element instanceof Element || element instanceof HTMLDocument\r\n}"],"names":["events","customMethods","allEvents","addTemplate","Object","getOwnPropertyNames","getPrototypeOf","document","filter","eventName","indexOf","map","substr","length","set","elements","func","forEach","get","element","only","index","methodName","call","customProps","removeEventObject","event","addAFunction","eventFunction","console","log","removeEventListener","removeEventFunction","remove","value","entries","defineProperties","propName","propFunc","funcVars","addEventListener","createQuery","literals","substitutions","Array","isArray","every","isValidElement","join","literal","String","Element","HTMLDocument","module","exports","query","from","querySelectorAll"],"mappings":"AAGA,IAsCQA,EACAC,EAsGAC,EA7IFC,GA6IED,EAAYE,OAAOC,oBAAoBD,OAAOE,eAAeF,OAAOE,eAAeC,YAAYC,OAAO,SAAAC,UACzGA,EAAUC,QAAQ,QAAiC,MAAvBH,SAASE,IAAoD,mBAAvBF,SAASE,MAC5EE,IAAI,SAAAF,UAAaA,EAAUG,OAAO,KAzG9BZ,EA0GCE,EAAUW,OAAS,EAAIX,EAAY,CAAC,QAAS,aAzG9CD,EAAgB,CACpBa,IAuEJ,gBAAwBC,IAAAA,SACtB,gBAAiBC,GAEf,OADAD,EAASE,QAAQD,GACVD,IAzEPG,IAgFJ,gBAAwBH,IAAAA,SACtB,gBAAiBC,GACf,OAAOD,EAASJ,IAAI,SAAAQ,UAAWH,EAAKG,OAjFpCC,KAwFJ,gBAAyBL,IAAAA,SACvB,gBAAiBM,GACf,OAAOlB,EAAY,CAACY,EAASM,OAzF7Bb,OA2DJ,gBAA0BO,IAAAA,SAAUO,IAAAA,WAClC,gBAAiBN,GACf,OAAOb,EAAY,GAAGmB,GAAYC,KAAKR,EAAUC,gBA3DlCD,GACf,IAAMS,EAAc,GACdC,EAAoB,GAS1B,OARAzB,EAAOiB,QAAQ,SAAAS,GACbC,EAAaH,EAAaE,EAAOE,EAAe,CAAEb,SAAAA,EAAUW,MAAAA,IAC5DD,EAAkBC,GAuCxB,gBAAgCX,IAAAA,SAAUW,IAAAA,MACxC,gBAAiBV,GAKf,OAJAa,QAAQC,IAAI,WAAYJ,EAAOX,GAC/BA,EAASE,QAAQ,SAAAE,GACfA,EAAQY,oBAAoBL,EAAOV,KAE9BD,GA7CsBiB,CAAoB,CAAEjB,SAAAA,EAAUW,MAAAA,MAE7DF,EAAYS,OAAS,CAAEC,MAAOT,GAC9BrB,OAAO+B,QAAQlC,GAAegB,QAAQ,gBAAEK,OACtCK,EAAaH,EAAaF,OAAwB,CAAEP,SAAAA,EAAUO,WAAAA,MAEzDlB,OAAOgC,iBAAiBrB,EAAUS,KAO7C,SAASG,EAAcH,EAAaa,EAAUC,EAAUC,GACtDf,EAAYa,GAAY,CACtBH,MAAOI,EAASC,IAUpB,SAASX,SAAiBb,IAAAA,SAAUW,IAAAA,MAClC,gBAAiBV,GAMf,OALAD,EAASE,QAAQ,SAAAE,GACfA,EAAQqB,iBAAiBd,EAAOV,KAI3BD,GAwEX,SAAS0B,EAAaC,EAAUC,GAC9B,OAAIC,MAAMC,QAAQH,IAAaA,EAASI,MAAMC,GACrCL,EACEE,MAAMC,QAAQH,IAAaE,MAAMC,QAAQF,GAC1B,KAApBD,EAASM,QAAiBL,EAAcG,MAAMC,GACzCJ,EAEAD,EAAS/B,IAAI,SAACsC,EAAS5B,GAC5B,OAAQ4B,GAAW,KAAON,EAActB,IAAU,MACjD2B,KAAK,KAAO,KAEY,iBAAbN,GAAyBA,aAAoBQ,OACtDR,OASX,SAASK,EAAgB5B,GACvB,OAAOA,aAAmBgC,SAAWhC,aAAmBiC,aA9K1DC,OAAOC,QAAU,SAAUZ,GACzB,IAAMa,EAAQd,EAAYC,8BAC1B,IAAKa,GAA0B,IAAjBA,EAAM1C,QAA0B,oBAAV0C,EAA6B,YACjE,GAAIX,MAAMC,QAAQU,GAChB,OAAOpD,EAAYoD,GAEnB,IAAMxC,EAAW6B,MAAMY,KAAKjD,SAASkD,iBAAiBF,IACtD,OAAOxC,EAASF,OAAS,EAAIV,EAAYY,GAAY"}