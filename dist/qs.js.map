{"version":3,"file":"qs.js","sources":["../src/index.js"],"sourcesContent":["/*\r\n * Initialise events and template\r\n */\r\nconst addTemplate = initTemplate()\r\n\r\n/*\r\n * Exports qs function\r\n * Creates new DOM query, and returns templated result\r\n * If element array passed, return templated result\r\n */\r\nmodule.exports = function (literals, ...substitutions) {\r\n  const query = createQuery(literals, substitutions)\r\n  if (isInvalidQuery(query)) {\r\n    return null\r\n  }\r\n  if (isArray(query)) {\r\n    return addTemplate(query)\r\n  }\r\n  return newQuerySelector(query)\r\n}\r\n\r\n/*\r\n * Gets elements with querySelectorAll and adds template\r\n * If no elements, return empty array\r\n */\r\nfunction newQuerySelector(query) {\r\n  const elements = Array.from(document.querySelectorAll(query))\r\n  return elements.length > 0 ? addTemplate(elements) : []\r\n}\r\n\r\n/*\r\n * Initialises events and customMethods, then returns a function that applies\r\n * changes to an element list:\r\n\r\n * Each of these properties applies to every element in the array:\r\n * - Adds every type of eventListener to the qs element list's hidden properties\r\n *   qs`.element`.click(clickFunc)\r\n * \r\n * - Adds a .remove property, to remove eventListeners \r\n *   qs`.element`.remove.click(clickFunc)\r\n * \r\n * - Adds set, to set properties of elements\r\n *   qs`.element`.set(el => el.style.color = 'red')\r\n * \r\n * - Adds get, to get an array of properties of elements\r\n *   const getText = qs`.element`.get(el => el.innerHTML) // ['an element', 'inside another']\r\n * \r\n * - Adds only to select a single element from an index, returning an array of 1\r\n *   qs`.element`.only(1) // [ HTMLElement ]\r\n * \r\n * - Modifies the following array methods, to return an array that has been parsed by qs:\r\n *   Filter\r\n *   qs`.element`.filter(el => el.innerHTML.includes('Title'))\r\n */\r\nfunction initTemplate () {\r\n  const events = getAllEvents()\r\n  const customMethods = {\r\n    set: setFunction,\r\n    get: getFunction,\r\n    only: onlyFunction,\r\n    filter: arrayFunction\r\n  }\r\n  return function (elements) {\r\n    const customProps = {}\r\n    const removeEventObject = {}\r\n    events.forEach(event => {\r\n      addAFunction(customProps, event, eventFunction, { elements, event })\r\n      removeEventObject[event] = removeEventFunction({ elements, event })\r\n    })\r\n    customProps.remove = { value: removeEventObject }\r\n    Object.entries(customMethods).forEach(([methodName, methodFunc]) => {\r\n      addAFunction(customProps, methodName, methodFunc, { elements, methodName })\r\n    })\r\n    return Object.defineProperties(elements, customProps)\r\n  }\r\n}\r\n\r\n/*\r\n * Adds a function to customProps, to be used in defuneProperties\r\n */\r\nfunction addAFunction (customProps, propName, propFunc, funcVars) {\r\n  customProps[propName] = {\r\n    value: propFunc(funcVars)\r\n  }\r\n}\r\n\r\n/*\r\n * The next few functions are all non-enumerable properties given to the created qs objects\r\n * Or in one case, an object that enables removes event listeners\r\n * \r\n * Creates an event listener, returns elements\r\n */\r\nfunction eventFunction ({ elements, event }) {\r\n  return function (func) {\r\n    elements.forEach(element => {\r\n      element.addEventListener(event, func)\r\n    })\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Removes event listener, returns elements\r\n */\r\nfunction removeEventFunction ({ elements, event }) {\r\n  return function (func) {\r\n    elements.forEach(element => {\r\n      element.removeEventListener(event, func)\r\n    })\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Applies array method then returns qs templated array\r\n */\r\nfunction arrayFunction ({ elements, methodName }) {\r\n  return function (func) {\r\n    return addTemplate([][methodName].call(elements, func))\r\n  }\r\n}\r\n\r\n/*\r\n * Cycles through elements letting you edit elements\r\n */\r\nfunction setFunction ({ elements }) {\r\n  return function (func) {\r\n    elements.forEach(func)\r\n    return elements\r\n  }\r\n}\r\n\r\n/*\r\n * Returns elements selected in func\r\n */\r\nfunction getFunction ({ elements }) {\r\n  return function (func) {\r\n    return elements.map(element => func(element))\r\n  }\r\n}\r\n\r\n/*\r\n * Selects an element by index and returns a qs templated array containing it\r\n */\r\nfunction onlyFunction ({ elements }) {\r\n  return function (index) {\r\n    return addTemplate([elements[index]])\r\n  }\r\n}\r\n\r\n/* \r\n * Returns an array of names of all available events\r\n * Works with JSDom for testing\r\n */\r\nfunction getAllEvents () {\r\n  const HTMLDocumentEvents = Object.getOwnPropertyNames(Object.getPrototypeOf(document)) || []\r\n  const DocumentEvents = Object.getOwnPropertyNames(Object.getPrototypeOf(Object.getPrototypeOf(document))) || []\r\n  const allEventNames = HTMLDocumentEvents.concat(DocumentEvents).filter(eventName =>\r\n    !eventName.indexOf('on') && (document[eventName] == null || typeof document[eventName] == 'function')\r\n  ).map(eventName => eventName.substr(2))\r\n  return allEventNames.length > 0 ? allEventNames : []\r\n}\r\n\r\n/*\r\n * Takes arguments from a tagged template literal\r\n * If valid HTML element array submitted as first argument, return\r\n * Else If array entered as a substitution, and no literals, return substitution array\r\n * Else If return a query string to be used with document.querySelectorAll\r\n * If not valid, return null\r\n */\r\nfunction createQuery (literals, substitutions) {\r\n  if (isArray(literals) && isElement(...literals)) {\r\n    return literals\r\n  } else if (isArray(literals, substitutions)) {\r\n    if (literals.join() === '' && isElement(...substitutions)) {\r\n      return substitutions\r\n    } else {\r\n      return combineTemplateArrays(literals, substitutions) || null\r\n    }\r\n  } else if (isString(literals)) {\r\n    return literals\r\n  } else {\r\n    return null\r\n  }\r\n}\r\n\r\n/*\r\n * Combines two arrays into one string, one index at a time\r\n * If undefined, uses an empty string\r\n */ \r\nfunction combineTemplateArrays(literals, substitutions) {\r\n  return literals.map((literal, index) => {\r\n    return (literal || '') + (substitutions[index] || '')\r\n  }).join('')\r\n}\r\n\r\n/*\r\n * Check if arguments are valid DOM elements\r\n */\r\nfunction isElement (...args) {\r\n  return args.every(arg => arg instanceof Element || arg instanceof HTMLDocument )\r\n}\r\n\r\n/* \r\n * Check if arguments are valid arrays\r\n*/\r\nfunction isArray (...args) {\r\n  return args.every(arg => Array.isArray(arg))\r\n}\r\n\r\n/* \r\n * Check if arguments are valid strings\r\n*/\r\nfunction isString (...args) {\r\n  return args.every(arg => typeof arg === 'string' || arg instanceof String)\r\n}\r\n\r\n/*\r\n * Checks if valid query\r\n */\r\nfunction isInvalidQuery(query) {\r\n  return !query || query.length === 0 || query === '[object Object]'\r\n}\r\n"],"names":["events","customMethods","HTMLDocumentEvents","DocumentEvents","allEventNames","addTemplate","Object","getOwnPropertyNames","getPrototypeOf","document","concat","filter","eventName","indexOf","map","substr","length","set","setFunction","get","getFunction","only","onlyFunction","arrayFunction","elements","customProps","removeEventObject","forEach","event","addAFunction","eventFunction","func","element","removeEventListener","removeEventFunction","remove","value","entries","methodName","methodFunc","defineProperties","newQuerySelector","query","Array","from","querySelectorAll","propName","propFunc","funcVars","addEventListener","call","index","createQuery","literals","substitutions","isArray","isElement","join","literal","combineTemplateArrays","args","every","arg","String","isString","Element","HTMLDocument","isInvalidQuery"],"mappings":"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"}